#!/usr/bin/env ruby

require 'huffshell'

cs = CommandSuggestor.new

puts "Huffshell"
puts "============="

history_files = HistoryReader.files

history_files.each do |history_filename|
  begin
    if HistoryReader.timestamps?(history_filename)
      shell_commands = OhMyZshReader.new(history_filename).shell_commands
    else
      shell_commands = HistoryReader.new(history_filename).shell_commands
    end
    puts "Importing #{history_filename} #{shell_commands.size} commands found"
    shell_commands.each{ |l| cs.add(l) }
  rescue
    puts "#{history_filename} is unreadable."
  end
end

puts cs.wordtree.root.line_count

puts "\n============="
puts "#{cs.commands.size.to_s.green} unique keywords"

puts
[1, 2, 5, 10, 20, 50, 100, 250].each do |count|
  puts "#{cs.wordtree.root.minimum(count).size.to_s.green} commands appear > #{count} times"
end

puts "\nMost common commands:"

cs.wordtree.root.minimum(10).sort_by {|e| e[1].line_count }.reverse[0,10].each do |word, node|
  puts "#{node.word} #{node.line_count.to_s.green}"
end

cs.truncate!(30)

puts "\nCommand tree:"
puts cs.to_tree
